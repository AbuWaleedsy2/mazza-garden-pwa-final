<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#10b981" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø©</title>

  <style>
    :root{
      --bg:#f3f4f6; 
      --card:#ffffff; 
      --text:#111827; 
      --muted:#1f2937;
      --accent:#10b981; 
      --b:rgba(17,24,39,.12);
      --safeB:env(safe-area-inset-bottom); 
      --safeT:env(safe-area-inset-top);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      font-weight:700; /* Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ: Ø£Ø³ÙˆØ¯ Ø¹Ø±ÙŠØ¶ */
    }
    header{
      position:sticky;top:0;z-index:10;
      background:rgba(255,255,255,.92);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--b);
      padding:12px 14px;
      padding-top:calc(12px + var(--safeT));
    }
    h1{margin:0;font-size:16px;font-weight:800}
    .sub{margin-top:4px;font-size:12px;color:var(--muted);font-weight:700}
    main{
      padding:14px;max-width:560px;margin:0 auto;
      padding-bottom:calc(82px + var(--safeB));
    }
    .card{
      background:var(--card);
      border:1px solid var(--b);
      border-radius:16px;
      padding:14px;
      margin-bottom:12px;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .field{display:flex;flex-direction:column;gap:6px;margin-top:10px}
    label{font-size:12px;color:var(--text);font-weight:800}
    input,select,textarea{
      font-size:16px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--b);
      background:#ffffff;
      color:var(--text);
      outline:none;
      font-weight:800;
    }
    input::placeholder,textarea::placeholder{color:rgba(17,24,39,.55)}
    textarea{min-height:92px;resize:vertical}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    button{
      flex:1;min-width:120px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--b);
      background:#e5e7eb;
      color:var(--text);
      font-size:15px;
      cursor:pointer;
      font-weight:900;
    }
    button.primary{
      background:#a7f3d0;
      border-color:rgba(16,185,129,.55);
    }
    button.danger{
      background:#fecaca;
      border-color:rgba(239,68,68,.45);
    }
    .muted{color:rgba(17,24,39,.85);font-size:12px;line-height:1.6;font-weight:700}
    .notice{
      border:1px solid rgba(245,158,11,.45);
      background:rgba(245,158,11,.12);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      line-height:1.6;
      font-weight:800;
      color:var(--text);
    }
    .pill{
      display:flex;gap:10px;align-items:flex-start;
      border:1px solid var(--b);
      border-radius:14px;
      background:#f9fafb;
      padding:10px;margin-top:10px;
    }
    .pill .x{border-radius:999px;width:60px;height:34px;flex:0 0 auto}
    .nav{
      position:fixed;left:0;right:0;bottom:0;z-index:10;
      background:rgba(255,255,255,.95);
      border-top:1px solid var(--b);
      padding:10px 10px calc(10px + var(--safeB));
    }
    /* ØªÙ… Ø¶Ø¨Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø³Ø¨Ø¹Ø© Ø¹Ù†Ø§ØµØ± */
    .nav .inner{max-width:560px;margin:0 auto;display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .nav button{
      min-width:unset;
      padding:10px 8px;
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:4px;
      background:#f3f4f6;
    }
    .nav button.active{
      background:#a7f3d0;
      border-color:rgba(16,185,129,.55);
    }
    .hidden{display:none !important}
    pre{
      white-space:pre-wrap;word-break:break-word;
      background:#ffffff;
      border:1px solid var(--b);
      border-radius:14px;
      padding:12px;
      font-size:12.5px;
      line-height:1.6;
      max-height:45vh;
      overflow:auto;
      color:var(--text);
      font-weight:800;
    }
    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,.35);
      display:none;align-items:flex-end;justify-content:center;
      padding:14px;z-index:20;
    }
    .modal.open{display:flex}
    .sheet{
      width:100%;max-width:560px;
      background:#ffffff;
      border:1px solid var(--b);
      border-radius:18px;
      overflow:hidden;
      color:var(--text);
    }
    .sheetHead{
      display:flex;justify-content:space-between;align-items:center;
      padding:12px 14px;border-bottom:1px solid var(--b);
      background:#f9fafb;
    }
    @media print{
      header,.nav,.no-print{display:none !important}
      body{background:#fff;color:#000}
      pre{background:#fff;border:1px solid #ddd;color:#000}
    }
</style>
</head>

<body>
<header class="no-print">
  <h1 id="appTitle">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø©</h1>
  <div class="sub">ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ© â€¢ Ø®Ø·Ø© Ø§Ù„ØºØ¯ â€¢ Ù…ÙˆØ§Ø¯ â€¢ NCR â€¢ ÙØ­Øµ â€¢ Ø³Ø¬Ù„</div>
</header>

<main>
  <section id="v-dashboard" class="view">
    <div class="card">
      <b>Ø§Ø®ØªØµØ§Ø±Ø§Øª</b>
      <div class="btns">
        <button class="primary" onclick="navTo('daily')">ğŸ—“ï¸ Ø§Ù„ÙŠÙˆÙ…</button>
        <button class="primary" onclick="navTo('plan')">ğŸ§­ Ø§Ù„ØºØ¯</button>
        <button onclick="navTo('material')">ğŸ“¦ Ø§Ù„Ù…ÙˆØ§Ø¯</button>
        <button onclick="navTo('history')">ğŸ—‚ï¸ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
      <div class="muted" id="lastReport">Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ±: Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>
    </div>

    <div class="card">
      <b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªØ´ØºÙŠÙ„</b>
      <div class="muted">
        1) Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù… â€œØªÙˆÙ„ÙŠØ¯â€.<br/>
        2) Ø§Ø³ØªØ®Ø¯Ù… â€œÙˆØ§ØªØ³Ø§Ø¨/Ù†Ø³Ø®/Ù…Ø´Ø§Ø±ÙƒØ©â€.<br/>
        3) â€œØ­ÙØ¸ Ø¨Ø§Ù„Ø³Ø¬Ù„â€ Ø«Ù… ØµØ¯Ù‘Ø± JSON Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ù…Ø³ØªÙ†Ø¯ Google Doc Ù„Ù„ØªÙ‚Ø±ÙŠØ±.
      </div>
    </div>
  </section>

  <section id="v-daily" class="view hidden">
    <div class="card">
      <b>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</b>

      <div class="row">
        <div class="field"><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input id="daily_date" type="date"></div>
        <div class="field"><label>Ø§Ù„Ø·Ù‚Ø³</label>
          <select id="daily_weather"><option>Ù…Ø´Ù…Ø³</option><option>ØºØ§Ø¦Ù…</option><option>Ù…Ø§Ø·Ø±</option><option>Ø¹Ø§ØµÙ</option></select>
        </div>
      </div>

      <div class="row">
        <div class="field"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„</label><input id="daily_workers" type="number" min="0" inputmode="numeric"></div>
        <div class="field"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</label><input id="daily_engineers" type="number" min="0" inputmode="numeric"></div>
      </div>

      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><select id="daily_main"></select></div>
      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label><select id="daily_sub"></select></div>
      <div class="field"><label>Ø§Ù„Ù†Ø´Ø§Ø·/Ø§Ù„Ø®Ø·ÙˆØ©</label><select id="daily_act"></select></div>

      <div class="btns">
        <button onclick="addWork('daily')">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
        <button onclick="clearPick('daily')">ğŸ§¹ Ù…Ø³Ø­ Ø§Ø®ØªÙŠØ§Ø±</button>
      </div>

      <div id="daily_list" class="muted"></div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ© -->
      <div class="field"><label>Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ©</label>
        <select id="daily_admin_select"></select>
      </div>
      <div class="btns">
        <button onclick="addAdminTask()">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ Ø¥Ø¯Ø§Ø±ÙŠ</button>
      </div>
      <div id="daily_admin_list" class="muted"></div>

      <div class="field"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea id="daily_notes"></textarea></div>
      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù„ØªÙ‚Ø±ÙŠØ± -->
      <div class="field"><label>Ø§Ù„Ù…Ø±Ø³Ù„</label>
        <select id="daily_sender">
          <option value="Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</option>
          <option value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
          <option value="Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª">Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª</option>
        </select>
      </div>
      <div class="btns">
        <button class="primary" onclick="generate('daily')">ğŸ§¾ ØªÙˆÙ„ÙŠØ¯</button>
        <button onclick="saveDraft('daily')">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      </div>
    </div>
  </section>

  <section id="v-plan" class="view hidden">
    <div class="card">
      <b>Ø®Ø·Ø© Ø§Ù„ØºØ¯</b>

      <div class="row">
        <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø·Ø©</label><input id="plan_date" type="date"></div>
        <div class="field"><label>ÙŠØªØ·Ù„Ø¨ ØªÙˆØ§Ø¬Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ</label>
          <select id="plan_need_pm"><option value="no">Ù„Ø§</option><option value="yes">Ù†Ø¹Ù…</option></select>
        </div>
      </div>
      <!-- Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©: ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© Ù„Ø®Ø·Ø© Ø§Ù„ØºØ¯ -->
      <div class="row">
        <div class="field"><label>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡</label><input id="plan_start" type="time"></div>
        <div class="field"><label>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© (Ø³Ø§Ø¹Ø§Øª)</label><input id="plan_duration" type="number" min="0" inputmode="numeric"></div>
      </div>

      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><select id="plan_main"></select></div>
      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label><select id="plan_sub"></select></div>
      <div class="field"><label>Ø§Ù„Ù†Ø´Ø§Ø·/Ø§Ù„Ø®Ø·ÙˆØ©</label><select id="plan_act"></select></div>

      <div class="btns">
        <button onclick="addWork('plan')">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
        <button onclick="clearPick('plan')">ğŸ§¹ Ù…Ø³Ø­ Ø§Ø®ØªÙŠØ§Ø±</button>
      </div>

      <div id="plan_list" class="muted"></div>

      <div class="field"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea id="plan_notes"></textarea></div>
      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù„ØªÙ‚Ø±ÙŠØ± -->
      <div class="field"><label>Ø§Ù„Ù…Ø±Ø³Ù„</label>
        <select id="plan_sender">
          <option value="Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</option>
          <option value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
          <option value="Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª">Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª</option>
        </select>
      </div>
      <div class="btns">
        <button class="primary" onclick="generate('plan')">ğŸ§¾ ØªÙˆÙ„ÙŠØ¯</button>
        <button onclick="saveDraft('plan')">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      </div>
    </div>
  </section>

  <section id="v-material" class="view hidden">
    <div class="card">
      <b>Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙˆØ§Ø¯</b>
      <div class="notice"><b>ØªÙ†Ø¨ÙŠÙ‡:</b> Ù„Ø¯ÙŠÙƒ 3 Ø³Ø§Ø¹Ø§Øª Ù„Ù„Ø±Ø¯ Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯.</div>

      <div class="row">
        <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</label><input id="mat_date" type="date"></div>
        <div class="field"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
          <select id="mat_status">
            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</option>
            <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option value="conditional">Ù…Ù‚Ø¨ÙˆÙ„ Ø¨Ù…Ù„Ø§Ø­Ø¸Ø§Øª</option>
            <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
          </select>
        </div>
      </div>

      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><select id="mat_main"></select></div>
      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label><select id="mat_sub"></select></div>
      <div class="field"><label>Ø§Ù„Ù†Ø´Ø§Ø·/Ø§Ù„Ø®Ø·ÙˆØ©</label><select id="mat_act"></select></div>

      <div class="field"><label>ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø©/Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label><input id="mat_item" type="text"></div>
      <div class="field"><label>Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ù…ØµØ¯Ø±</label><input id="mat_supplier" type="text"></div>
      <div class="field"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø±</label><textarea id="mat_notes"></textarea></div>

      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù„ØªÙ‚Ø±ÙŠØ± -->
      <div class="field"><label>Ø§Ù„Ù…Ø±Ø³Ù„</label>
        <select id="mat_sender">
          <option value="Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</option>
          <option value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
          <option value="Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª">Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª</option>
        </select>
      </div>

      <div class="btns">
        <button class="primary" onclick="generate('material')">ğŸ§¾ ØªÙˆÙ„ÙŠØ¯</button>
        <button onclick="saveDraft('material')">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      </div>
    </div>
  </section>

  <section id="v-more" class="view hidden">
    <div class="card">
      <b>Ø§Ù„Ù…Ø²ÙŠØ¯</b>
      <div class="btns">
        <button onclick="navTo('ncr')">â›” NCR</button>
        <button onclick="navTo('inspection')">ğŸ§ª Ø·Ù„Ø¨ ÙØ­Øµ</button>
        <button onclick="navTo('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button onclick="navTo('history')">ğŸ—‚ï¸ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
    </div>
  </section>

  <section id="v-ncr" class="view hidden">
    <div class="card">
      <b>Ø¹Ø¯Ù… Ù…Ø·Ø§Ø¨Ù‚Ø© (NCR)</b>

      <div class="row">
        <div class="field"><label>Ø±Ù‚Ù… NCR</label><input id="ncr_no" type="text" readonly></div>
        <div class="field"><label>Ø§Ù„Ø®Ø·ÙˆØ±Ø©</label>
          <select id="ncr_sev"><option value="low">Ù…Ù†Ø®ÙØ¶</option><option value="med">Ù…ØªÙˆØ³Ø·</option><option value="high">Ø¹Ø§Ù„</option></select>
        </div>
      </div>

      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><select id="ncr_main"></select></div>
      <div class="field"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label><select id="ncr_sub"></select></div>
      <div class="field"><label>Ø§Ù„Ù†Ø´Ø§Ø·/Ø§Ù„Ø®Ø·ÙˆØ©</label><select id="ncr_act"></select></div>

      <div class="field"><label>ÙˆØµÙ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</label><textarea id="ncr_desc"></textarea></div>
      <div class="field"><label>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ</label><textarea id="ncr_action"></textarea></div>
      <div class="field"><label>Ø§Ù„Ù…Ù‡Ù„Ø©</label><input id="ncr_deadline" type="date"></div>

      <div class="field">
        <label>Ù…Ø±ÙÙ‚ ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="ncr_file" type="file" accept="image/*">
        <div class="muted">Ù„Ù† ØªÙØ­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙØ¹Ù‘Ù„Øª Ø°Ù„Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</div>
      </div>

      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù„ØªÙ‚Ø±ÙŠØ± -->
      <div class="field"><label>Ø§Ù„Ù…Ø±Ø³Ù„</label>
        <select id="ncr_sender">
          <option value="Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</option>
          <option value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
          <option value="Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª">Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª</option>
        </select>
      </div>

      <div class="btns">
        <button class="danger" onclick="generate('ncr')">â›” ØªÙˆÙ„ÙŠØ¯</button>
        <button onclick="saveDraft('ncr')">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      </div>
    </div>
  </section>

  <section id="v-inspection" class="view hidden">
    <div class="card">
      <b>Ø·Ù„Ø¨ ÙØ­Øµ</b>

      <div class="row">
        <div class="field"><label>ØªØ§Ø±ÙŠØ®/ÙˆÙ‚Øª Ù…Ù‚ØªØ±Ø­</label><input id="insp_dt" type="datetime-local"></div>
        <div class="field"><label>ÙŠØªØ·Ù„Ø¨ Ø­Ø¶ÙˆØ± Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ</label>
          <select id="insp_need_pm"><option value="no">Ù„Ø§</option><option value="yes">Ù†Ø¹Ù…</option></select>
        </div>
      </div>

      <div class="row">
        <div class="field"><label>Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ</label>
          <select id="insp_type"><option>Ù…Ø¯Ù†ÙŠ/Ø¥Ù†Ø´Ø§Ø¦ÙŠ</option><option>ØªØ´Ø·ÙŠØ¨Ø§Øª</option><option>Ø±ÙŠ/Ù…ÙŠÙƒØ§Ù†ÙŠÙƒ</option><option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ø¥Ù†Ø§Ø±Ø©</option><option>Ø²Ø±Ø§Ø¹Ø©/Ø­Ø¯Ø§Ø¦Ù‚</option><option>Ø£Ø®Ø±Ù‰</option></select>
        </div>
        <div class="field"><label>Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„Ù…ÙƒØ§Ù†</label><input id="insp_loc" type="text"></div>
      </div>

      <div class="field"><label>Ø³Ø¨Ø¨/ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨</label><textarea id="insp_notes"></textarea></div>
      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù„ØªÙ‚Ø±ÙŠØ± -->
      <div class="field"><label>Ø§Ù„Ù…Ø±Ø³Ù„</label>
        <select id="insp_sender">
          <option value="Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</option>
          <option value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
          <option value="Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª">Ø¥Ø¯Ø§Ø±Ø© ÙØ¶Ø§Ø¡Ø§Øª</option>
        </select>
      </div>
      <div class="btns">
        <button class="primary" onclick="generate('inspection')">ğŸ§ª ØªÙˆÙ„ÙŠØ¯</button>
        <button onclick="saveDraft('inspection')">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      </div>
    </div>
  </section>

  <section id="v-history" class="view hidden">
    <div class="card">
      <b>Ø§Ù„Ø³Ø¬Ù„</b>

      <div class="row">
        <div class="field"><label>Ø¨Ø­Ø«</label><input id="hist_q" type="text"></div>
        <div class="field"><label>Ø§Ù„Ù†ÙˆØ¹</label>
          <select id="hist_type">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
            <option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
            <option value="plan">Ø®Ø·Ø© Ø§Ù„ØºØ¯</option>
            <option value="material">Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙˆØ§Ø¯</option>
            <option value="ncr">NCR</option>
            <option value="inspection">Ø·Ù„Ø¨ ÙØ­Øµ</option>
          </select>
        </div>
      </div>

      <div class="btns">
        <button onclick="exportJSONFiltered()">â¬‡ï¸ JSON Ø­Ø³Ø¨ Ø§Ù„ÙÙ„ØªØ±</button>
        <button onclick="exportJSONAll()">â¬‡ï¸ JSON Ø§Ù„ÙƒÙ„</button>
      </div>
      <div class="btns">
        <button onclick="exportToSheetFiltered()">ğŸ“¤ Google Sheet Ø­Ø³Ø¨ Ø§Ù„ÙÙ„ØªØ±</button>
        <button onclick="testWebhook()">ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Sheet</button>
      </div>

      <div id="hist_list" class="muted" style="margin-top:10px"></div>
    </div>
  </section>

  <section id="v-settings" class="view hidden">
    <div class="card">
      <b>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</b>

      <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input id="set_title" type="text"></div>
      <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙØ¯Ø®Ù„ (ØªÙˆÙ‚ÙŠØ¹)</label><input id="set_name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø§Ù„Ø¯ - Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"></div>

      <div class="row">
        <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input id="set_start" type="date"></div>
        <div class="field"><label>Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)</label><input id="set_dur" type="number" min="1" inputmode="numeric"></div>
      </div>

      <div class="row">
        <div class="field"><label>Ø­Ø¯ Ø§Ù„Ø³Ø¬Ù„</label><input id="set_max" type="number" min="0" inputmode="numeric" placeholder="200 (0 Ø¨Ù„Ø§ Ø­Ø¯)"></div>
        <div class="field"><label>Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„ØŸ</label>
          <select id="set_keep_files"><option value="no">Ù„Ø§</option><option value="yes">Ù†Ø¹Ù…</option></select>
        </div>
      </div>

      <div class="field"><label>Google Sheets Webhook URL (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="set_webhook" type="url"></div>

      <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙ†Ø¯Ø§Øª Google -->
      <div class="field"><label>Google Docs Webhook URL</label><input id="set_doc_webhook" type="url"></div>
      <div class="field"><label>ØªÙˆÙƒÙ† Ø§Ù„Ø£Ù…Ø§Ù† (Ù…Ø®ÙÙŠ)</label><input id="set_doc_token" type="password"></div>

      <div class="btns">
        <button class="primary" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸</button>
        <button onclick="navTo('dashboard')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>

      <div class="btns">
        <button class="danger" onclick="resetAll()">ğŸ§¨ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>

      <div class="muted">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ: Ù…Ù† â€œØ§Ù„Ø³Ø¬Ù„â€ ØµØ¯Ù‘Ø± JSON Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹.</div>
    </div>
  </section>
</main>

<!--
  ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ù„ÙŠØ­ØªÙˆÙŠ Ø³Ø¨Ø¹Ø© ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙƒÙ…Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….
  ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø²Ø± "Ø§Ù„Ù…Ø²ÙŠØ¯" ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø£Ø²Ø±Ø§Ø± Ù…Ø³ØªÙ‚Ù„Ø© Ù„Ø·Ù„Ø¨ Ø§Ù„ÙØ­Øµ ÙˆNCR ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.
-->
<nav class="nav no-print">
  <div class="inner">
    <button id="n-dashboard" onclick="navTo('dashboard')">ğŸ <div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div></button>
    <button id="n-daily" onclick="navTo('daily')">ğŸ—“ï¸<div>Ø§Ù„ÙŠÙˆÙ…</div></button>
    <button id="n-plan" onclick="navTo('plan')">ğŸ§­<div>Ø§Ù„ØºØ¯</div></button>
    <button id="n-material" onclick="navTo('material')">ğŸ“¦<div>Ø§Ù„Ù…ÙˆØ§Ø¯</div></button>
    <button id="n-inspection" onclick="navTo('inspection')">ğŸ§ª<div>Ø§Ù„ÙØ­Øµ</div></button>
    <button id="n-ncr" onclick="navTo('ncr')">â›”<div>NCR</div></button>
    <button id="n-settings" onclick="navTo('settings')">âš™ï¸<div>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div></button>
  </div>
</nav>

<div class="modal no-print" id="outModal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="sheetHead">
      <b id="outTitle">Ø§Ù„Ù†Øµ</b>
      <button onclick="closeOut()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div style="padding:12px 14px">
      <pre id="outText"></pre>

      <div class="btns">
        <button class="primary" onclick="shareText()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
        <button onclick="copyText()">ğŸ“‹ Ù†Ø³Ø®</button>
      </div>
      <div class="btns">
        <button onclick="waText()">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button onclick="downloadTXT()">ğŸ“„ TXT</button>
      </div>
      <div class="btns">
        <button onclick="printText()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©/PDF</button>
        <button class="primary" onclick="saveToHistory()">ğŸ—‚ï¸ Ø­ÙØ¸ Ø¨Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
      <div class="btns">
        <button onclick="docCurrent()">ğŸ“„ Google Doc</button>
      </div>

      <div class="muted" id="outHint"></div>
    </div>
  </div>
</div>

<script>
const KEY = "mazza_pm_v3_store";
const DEFAULTS = {
  settings: {
    title: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø©",
    name: "",
    startDate: new Date().toISOString().slice(0,10),
    durationDays: 45,
    maxReports: 200,
    keepFiles: "no",
    webhookUrl: "",
    // Ø±ÙˆØ§Ø¨Ø· ÙˆØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙØ© Ø¹Ø¨Ø± Ù…Ø³ØªÙ†Ø¯Ø§Øª Google
    docWebhookUrl: "",
    docWebhookToken: ""
  },
  drafts: {},
  reports: [],
  pendingDocs: []
};

let TAXONOMY = [];
const TAX_CACHE_KEY = "mazza_pm_v3_taxonomy_cache";
// Fallback taxonomy (used only if taxonomy.json is missing/unreachable)
const EMBED_TAXONOMY = [{"main": "Ø§Ù„Ø´Ù„Ø§Ù„", "subs": [{"sub": "ØµÙŠØ§Ù†Ø© ÙˆØªØ£Ù‡ÙŠÙ„", "acts": ["ÙƒØ´Ù Ù…Ø¨Ø¯Ø¦ÙŠ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„Ø© (ØµÙˆØ±/Ù…Ù„Ø§Ø­Ø¸Ø§Øª)", "Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚/Ø§Ù„Ù…Ø®Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±", "ØªÙ†Ø¸ÙŠÙ Ø£Ø­ÙˆØ§Ø¶/Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø´Ù„Ø§Ù„", "Ø¥ØµÙ„Ø§Ø­/ØªØ±Ù…ÙŠÙ… Ø³Ø·Ø­ Ø§Ù„Ø®Ø±Ø³Ø§Ù†Ø© Ø§Ù„Ù…ØªØ¶Ø±Ø±", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø´Ø±ÙˆØ®/ÙÙˆØ§ØµÙ„ (Ø³Ø¯/Ø­Ù‚Ù† Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)", "ØªÙ†Ø¹ÙŠÙ… ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ø·Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø²Ù„", "ÙØ­Øµ Ù…ÙŠÙˆÙ„/ØªØµØ±ÙŠÙ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©", "Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„Ù…Ø³Ø§Ø± Ø¨Ø§Ù„Ù…Ø§Ø¡", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]}, {"sub": "Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙˆÙˆØµÙ„Ø§Øª", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¨Ø·", "ÙÙƒ/Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„Ù Ù…Ù† Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙˆØ§Ù„ÙˆØµÙ„Ø§Øª", "ØªÙˆØ±ÙŠØ¯ Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙˆÙˆØµÙ„Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª", "ØªØ±ÙƒÙŠØ¨ Ù…Ø­Ø§Ø¨Ø³/ÙÙ„Ø§ØªØ± (Ø¥Ù† ÙˆØ¬Ø¯Øª)", "Ø¹Ø²Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª", "Ø§Ø®ØªØ¨Ø§Ø± Ø¶ØºØ·/ØªØ³Ø±ÙŠØ¨", "ØªØµØ­ÙŠØ­ Ø§Ù„ØªØ³Ø±ÙŠØ¨Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", "ØªÙ†Ø¸ÙŠÙ… ÙˆØ±Ø¨Ø· Ù†Ù‡Ø§Ø¦ÙŠ Ø¯Ø§Ø®Ù„ ØºØ±ÙØ© Ø§Ù„Ù…Ø¶Ø®Ø©", "ØªÙˆØ«ÙŠÙ‚ Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°"]}, {"sub": "Ø¹Ø²Ù„ Ù…Ø§Ø¦ÙŠ", "acts": ["ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ø·Ø­ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ØªØ±Ø¨Ø© ÙˆØ§Ù„Ø²ÙŠÙˆØª", "Ø¨Ø±Ø§ÙŠÙ…Ø± (Ø¥Ù† Ù„Ø²Ù…) Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø²Ù„", "ØªØ·Ø¨ÙŠÙ‚ Ø·Ø¨Ù‚Ø© Ø¹Ø²Ù„ Ø£ÙˆÙ„Ù‰", "ØªØ·Ø¨ÙŠÙ‚ Ø·Ø¨Ù‚Ø© Ø¹Ø²Ù„ Ø«Ø§Ù†ÙŠØ© (Ù…Ø¹ ØªØ¯Ø§Ø®Ù„Ø§Øª)", "Ø¹Ø²Ù„ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„ÙÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª", "Ø­Ù…Ø§ÙŠØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø²Ù„ (Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ©/Ù„ÙŠØ§Ø³Ø©)", "Ø§Ø®ØªØ¨Ø§Ø± ØºÙ…Ø±/ØªØ³Ø±ÙŠØ¨ Ù„Ù…Ø¯Ø© ÙƒØ§ÙÙŠØ©", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", "ØªÙ†Ø¸ÙŠÙ Ù…Ø­ÙŠØ· Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø²Ù„", "Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ø²Ù„ (Ù…Ø­Ø¶Ø±/ØµÙˆØ±)"]}, {"sub": "Ù…Ø¶Ø®Ø§Øª ÙˆØªØ´ØºÙŠÙ„", "acts": ["ØªÙˆØ±ÙŠØ¯/ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø¶Ø®Ø© Ø£Ùˆ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©", "ØªÙˆØµÙŠÙ„ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø¢Ù…Ù† (Ù‚Ø§Ø·Ø¹/ØªØ£Ø±ÙŠØ¶)", "ØªØ±ÙƒÙŠØ¨ ØµÙ…Ø§Ù…Ø§Øª Ø¹Ø¯Ù… Ø±Ø¬ÙˆØ¹ (Ø¥Ù† ÙˆØ¬Ø¯Øª)", "Ø¶Ø¨Ø· Ø§Ù„Ø§Ø±ØªÙØ§Ø¹/Ø§Ù„ØªØ¯ÙÙ‚ (Calibration)", "ØªØ´ØºÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø£ÙˆÙ„ÙŠ", "Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¶Ø¬ÙŠØ¬/Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø©", "Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚/Ø¶ØºØ· ÙØ¹Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù„Ø§Ù„", "ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± Ù…Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø±", "ØªØ³Ù„ÙŠÙ… ØªØ´ØºÙŠÙ„ÙŠ ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª ØªØ´ØºÙŠÙ„", "ØªÙˆÙ‚ÙŠØ¹ Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ø¯Ø±Ø¬", "subs": [{"sub": "Ø¥ÙƒØ³Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø¬", "acts": ["Ø±ÙØ¹ Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¯Ø±Ø¬ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„", "ØªÙ‚Ø¯ÙŠÙ… Ø¹ÙŠÙ†Ø©/Ù…ÙˆÙƒ Ø£Ø¨ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©", "ØªÙˆØ±ÙŠØ¯ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥ÙƒØ³Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹", "ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ø·Ø­ (ØªÙ†Ø¸ÙŠÙ/ØªØ³ÙˆÙŠØ©)", "Ù‚Øµ ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚Ø·Ø¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù‚Ø·Ø¹ ÙˆØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ù†Ø§Ø³ÙŠØ¨", "ØªØ±ÙˆÙŠØ¨ Ø§Ù„ÙÙˆØ§ØµÙ„ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­ÙˆØ§Ù", "ØªÙ†Ø¸ÙŠÙ Ø£ÙˆÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ¨", "ÙØ­Øµ Ø§Ø³ØªÙˆØ§Ø¡/ØªÙØ§ÙˆØª ÙˆØ¥ØµÙ„Ø§Ø­", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØªØ³Ù„ÙŠÙ…"]}, {"sub": "Ø­Ù…Ø§ÙŠØ© ÙˆØªÙØ§ØµÙŠÙ„", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", "ØªÙˆØ±ÙŠØ¯ Ù…Ù„Ø­Ù‚Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© (Ø¥Ù† ÙˆØ¬Ø¯Øª)", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­ÙˆØ§Ù/Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ø­Ø§Ø¯Ø©", "ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø§Ù„ØªØµØ§Ù‚/Ø§Ù„Ø«Ø¨Ø§Øª", "ØªØµØ­ÙŠØ­ Ø£ÙŠ ØªÙÙƒÙƒ Ø£Ùˆ ÙØ±Ø§ØºØ§Øª", "ØªÙ†Ø¸ÙŠÙ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„", "ØªÙˆØ«ÙŠÙ‚ Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ø¯Ø±Ø§Ø¨Ø²ÙŠÙ†", "acts": ["Ø±ÙØ¹ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ÙˆØ®Ø· Ø§Ù„Ø³ÙŠØ±", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø¨Ø²ÙŠÙ†/Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", "ØªØ¬Ù‡ÙŠØ² Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", "Ø¹Ø²Ù„/Ø¥ØºÙ„Ø§Ù‚ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ«Ø¨ÙŠØª", "ÙØ­Øµ ØµÙ„Ø§Ø¨Ø© ÙˆØªØ­Ù…Ù„", "ØªØ´Ø·ÙŠØ¨/Ø¯Ù‡Ø§Ù† (Ø¥Ù† ÙˆØ¬Ø¯)", "ØªÙ†Ø¸ÙŠÙ ÙˆØµÙŠØ§Ù†Ø© Ø³Ø·Ø­ÙŠØ©", "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª", "ØªØ³Ù„ÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ù…Ø¸Ù„Ø© Ø§Ù„Ù…Ø·Ø±ÙŠØ©", "subs": [{"sub": "Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ¯Ø¹Ø§Ù…Ø§Øª", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©", "ÙØ­Øµ ØªØ­Ù…Ù„/ØªØ³Ù„ÙŠØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø¥Ù† Ù„Ø²Ù…)", "Ø­ÙØ± ÙˆØªØ¬Ù‡ÙŠØ² Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª", "ØªÙˆØ±ÙŠØ¯ Ù‚ÙˆØ§Ø¹Ø¯/Ø¯Ø¹Ø§Ù…Ø§Øª", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø¯Ø¹Ø§Ù…Ø§Øª ÙˆØ¶Ø¨Ø· Ø§Ù„Ø´Ø§Ù‚ÙˆÙ„", "ØªØ«Ø¨ÙŠØª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ ÙˆØ±Ø¨Ø· Ù†Ù‡Ø§Ø¦ÙŠ", "Ø¹Ø²Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¶Ø¯ Ø§Ù„Ù…ÙŠØ§Ù‡", "ÙØ­Øµ Ø«Ø¨Ø§Øª ÙˆØªØ­Ù…Ù„", "ØªÙ†Ø¸ÙŠÙ Ù…Ø­ÙŠØ· Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "ØªØ¬Ù…ÙŠØ¹ ÙˆØªØ±ÙƒÙŠØ¨", "acts": ["ØªÙˆØ±ÙŠØ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¸Ù„Ø©", "ØªØ¬Ù…ÙŠØ¹ Ø£ÙˆÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ (Ø¥Ù† Ù„Ø²Ù…)", "Ø±ÙØ¹ ÙˆØªØ±ÙƒÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ø§Ù…Ø§Øª", "Ø¶Ø¨Ø· Ù…ÙŠÙ„Ø§Ù† ÙˆØªØµØ±ÙŠÙ Ø§Ù„Ù…ÙŠØ§Ù‡", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª/Ø§Ù„Ù…Ø²Ø§Ø±ÙŠØ¨ (Ø¥Ù† ÙˆØ¬Ø¯Øª)", "Ø¥Ø­ÙƒØ§Ù… Ø§Ù„Ø±Ø¨Ø· ÙˆÙ…Ù†Ø¹ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²", "Ø§Ø®ØªØ¨Ø§Ø± ØªØµØ±ÙŠÙ Ø¨Ø§Ù„Ù…Ø§Ø¡", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙŠ ØªØ³Ø±ÙŠØ¨/ØªØ¬Ù…Ø¹", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ", "ØªØ³Ù„ÙŠÙ… ØªØ´ØºÙŠÙ„ÙŠ"]}]}, {"main": "Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù…ÙˆÙ„Ø¯/Ø®Ø²Ø§Ù†Ø§Øª/ØªÙƒÙŠÙŠÙ)", "subs": [{"sub": "Ø³ØªØ§Ø¦Ø± Ø¥Ø®ÙØ§Ø¡", "acts": ["Ø±ÙØ¹ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…", "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø´ÙƒÙ„/Ø§Ù„Ø¹ÙŠÙ†Ø©", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø³ØªØ§Ø¦Ø±/Ø§Ù„Ù‡ÙŠÙƒÙ„", "ØªØ¬Ù‡ÙŠØ² Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ«Ø¨ÙŠØª", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø³ØªØ§Ø¦Ø± ÙˆØ¶Ø¨Ø· Ø§Ù„Ø§Ø³ØªÙ‚Ø§Ù…Ø©", "ÙØ­Øµ Ø§Ù„Ø«Ø¨Ø§Øª Ø¶Ø¯ Ø§Ù„Ø±ÙŠØ§Ø­", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­ÙˆØ§Ù/Ø§Ù„Ù‚Ø·Ø¹", "ØªÙ†Ø¸ÙŠÙ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "ØªØ³Ù„ÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ù…Ø´Ø±Ø¨ÙŠØ§Øª/ÙƒØ³ÙˆØ© Ø­Ø¬Ø±ÙŠØ©", "acts": ["ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©", "ØªÙ†Ø¸ÙŠÙ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„Ù", "ØªÙˆØ±ÙŠØ¯ Ø­Ø¬Ø±/Ø¨Ø¯Ø§Ø¦Ù„ Ù…Ù†Ø§Ø³Ø¨Ø© (Ø¥Ù† Ù„Ø²Ù…)", "ØªØ±ÙƒÙŠØ¨/ØªØ±Ù…ÙŠÙ… Ù…ÙˆØ¶Ø¹ÙŠ", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ ÙˆØ§Ù„ØªØ±ÙˆÙŠØ¨", "ÙØ­Øµ Ø§Ù„ØªØ«Ø¨ÙŠØª", "ØªÙ†Ø¸ÙŠÙ ÙˆØªÙ„Ù…ÙŠØ¹", "ØªØµØ­ÙŠØ­ Ø£ÙŠ ØªÙØ§ÙˆØª", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ù…Ù…Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ", "subs": [{"sub": "Ø±Ø®Ø§Ù…", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù…Ø± ÙˆØ±ÙØ¹ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª", "Ø§Ø¹ØªÙ…Ø§Ø¯ Ù†ÙˆØ¹/Ø¹ÙŠÙ†Ø© Ø§Ù„Ø±Ø®Ø§Ù…", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø±Ø®Ø§Ù… Ù„Ù„Ù…ÙˆÙ‚Ø¹", "ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (ØªØ³ÙˆÙŠØ©/Ù…ÙˆÙ†Ø©)", "Ù‚Øµ ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚Ø·Ø¹", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ù†Ø§Ø³ÙŠØ¨", "ØªØ±ÙˆÙŠØ¨ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ§ØµÙ„", "Ø¬Ù„ÙŠ/ØªÙ„Ù…ÙŠØ¹ (Ø¥Ù† Ù„Ø²Ù…)", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ø­ÙˆØ§Ø¬Ø²/Ø­ØµØ± Ø­Ø¬Ø± Ù„Ù„Ø¹Ø´Ø¨", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ø¬Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©", "Ø­ÙØ±/ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø­Ø§Ø¬Ø²/Ø§Ù„Ø­Ø¬Ø±", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª", "Ø¶Ø¨Ø· Ø§Ù„Ø§Ø³ØªÙ‚Ø§Ù…Ø© ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹", "ØªØ±ÙˆÙŠØ¨/ØªØ«Ø¨ÙŠØª Ù†Ù‡Ø§Ø¦ÙŠ", "ÙØ­Øµ Ø§Ù„Ù…ØªØ§Ù†Ø©", "ØªÙ†Ø¸ÙŠÙ Ù…Ø­ÙŠØ· Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ø£Ø­ÙˆØ§Ø¶", "subs": [{"sub": "ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†", "acts": ["ÙƒØ´Ù Ø§Ù„Ø£Ø­ÙˆØ§Ø¶ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ„Ù", "Ø¥Ø²Ø§Ù„Ø© Ø£Ø¬Ø²Ø§Ø¡ Ù…ÙÙƒÙƒØ©/Ù…ØªØ¶Ø±Ø±Ø©", "ØªØ±Ù…ÙŠÙ…/Ù„ÙŠØ§Ø³Ø© Ù…ÙˆØ¶Ø¹ÙŠØ©", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø´Ø±ÙˆØ® ÙˆÙÙˆØ§ØµÙ„", "Ø¹Ø²Ù„ Ø¯Ø§Ø®Ù„ÙŠ (Ø¥Ù† Ù„Ø²Ù…)", "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­ÙˆØ§Ù", "ÙØ­Øµ Ø§Ø³ØªÙˆØ§Ø¡ ÙˆÙ…ÙŠÙˆÙ„", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "ØªØ±Ø¨Ø© ÙˆØªØ¬Ù‡ÙŠØ²", "acts": ["ØªÙˆØ±ÙŠØ¯ ØªØ±Ø¨Ø© Ø²Ø±Ø§Ø¹ÙŠØ©", "ØªÙØ±ÙŠØº ÙˆÙØ±Ø´ Ø§Ù„ØªØ±Ø¨Ø©", "Ø®Ù„Ø· Ù…Ø¹ Ù…Ø­Ø³Ù†Ø§Øª/Ø³Ù…Ø§Ø¯ (Ø¥Ù† Ù„Ø²Ù…)", "ØªØ³ÙˆÙŠØ© ÙˆØªØ´ÙƒÙŠÙ„ Ø£Ø­ÙˆØ§Ø¶", "Ø±ÙŠ Ø£ÙˆÙ„ÙŠ Ù„Ù„ØªØ«Ø¨ÙŠØª", "Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© ØªØºØ·ÙŠØ©/Ù…Ù„Ø´ (Ø¥Ù† Ù„Ø²Ù…)", "ÙØ­Øµ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ±Ø¨Ø©", "ØªÙ†Ø¸ÙŠÙ Ù…Ø­ÙŠØ· Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ø²Ø±Ø§Ø¹Ø©", "ØªØ³Ù„ÙŠÙ…"]}]}, {"main": "Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ©", "subs": [{"sub": "ØµØ¨Ø© Ø¥Ø³Ù…Ù†ØªÙŠØ© Ù…Ø³Ù„Ø­Ø©", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚ÙŠØ§Ø³Ø§Øª", "ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø´Ø¯Ø©/Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨", "ØªØ³Ù„ÙŠØ­ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…ØªØ§Ø­", "ØµØ¨ Ø§Ù„Ø®Ø±Ø³Ø§Ù†Ø©", "Ù‡Ø²/Ø¯Ù…Ùƒ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø·Ø­ÙŠØ©", "Ù…Ø¹Ø§Ù„Ø¬Ø©/Ø¥Ù†Ø¶Ø§Ø¬ (Curing)", "ÙÙƒ Ø§Ù„Ø´Ø¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø©", "Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¹Ø´ÙŠØ´/Ø¹ÙŠÙˆØ¨", "ØªÙ†Ø¸ÙŠÙ Ù…Ø­ÙŠØ· Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ"]}, {"sub": "Ø±Ø®Ø§Ù… Ø§Ù„Ø¬Ù„Ø³Ø©", "acts": ["Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹ÙŠÙ†Ø© Ø§Ù„Ø±Ø®Ø§Ù…", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø±Ø®Ø§Ù…", "Ù‚Øµ ÙˆØªØ¬Ù‡ÙŠØ²", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª", "ØªØ±ÙˆÙŠØ¨ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø©", "Ø¬Ù„ÙŠ/ØªÙ„Ù…ÙŠØ¹ (Ø¥Ù† Ù„Ø²Ù…)", "ØªÙ†Ø¸ÙŠÙ", "ÙØ­Øµ Ø§Ø³ØªÙˆØ§Ø¡", "ØªØµØ­ÙŠØ­ Ø£ÙŠ Ø¹ÙŠÙˆØ¨", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ø­Ø¬Ø± Ø¨Ø§Ø²Ù„ØªÙŠ", "acts": ["Ø§Ø¹ØªÙ…Ø§Ø¯ Ù†ÙˆØ¹/Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¨Ø§Ø²Ù„Øª", "ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø²Ù„Øª", "ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©", "ØªØ±ÙƒÙŠØ¨ Ø­ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©", "ØªØ±ÙˆÙŠØ¨/ØªØ«Ø¨ÙŠØª", "ÙØ­Øµ Ù…Ù†Ø³ÙˆØ¨/Ø§Ø³ØªÙ‚Ø§Ù…Ø©", "ØªÙ†Ø¸ÙŠÙ", "ØªØµØ­ÙŠØ­ Ø£ÙŠ ØªÙØ§ÙˆØª", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ù…Ø¸Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ©", "subs": [{"sub": "Ø­Ù ÙˆØªØ­Ø¶ÙŠØ±", "acts": ["Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø­ÙŠØ·Ø©", "Ø­Ù/ØµÙ†ÙØ±Ù‡ Ø¥Ø²Ø§Ù„Ø© ØµØ¯Ø£", "ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØºØ¨Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù", "Ù…Ø¹Ø§Ù„Ø¬Ø© ØµØ¯Ø£ Ù…ÙˆØ¶Ø¹ÙŠ", "ÙØ­Øµ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ø¯Ù‡Ø§Ù†", "ØªØ¬Ù‡ÙŠØ² Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©", "ØªØºØ·ÙŠØ© Ø£Ù…Ø§ÙƒÙ† Ù„Ø§ ØªÙØ¯Ù‡ÙÙ†", "ØªÙ†ÙÙŠØ° ØªØµØ­ÙŠØ­ Ø³Ø·Ø­ÙŠ", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù‡Ø§Ù†", "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ©"]}, {"sub": "Ø¯Ù‡Ø§Ù†", "acts": ["ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±Ø§ÙŠÙ…Ø±", "ÙØ­Øµ ØªØºØ·ÙŠØ© Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…Ø±", "Ø¯Ù‡Ø§Ù† Ø·Ø¨Ù‚Ø© Ø£ÙˆÙ„Ù‰", "ÙØªØ±Ø© Ø¬ÙØ§Ù/ØªØµÙ„Ø¨", "Ø¯Ù‡Ø§Ù† Ø·Ø¨Ù‚Ø© Ø«Ø§Ù†ÙŠØ©", "ÙØ­Øµ Ø³Ù…Ø§ÙƒØ©/ØªØºØ·ÙŠØ©", "Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙ‚Ø§Ø¹Ø§Øª/Ø¹ÙŠÙˆØ¨", "ØªÙ†Ø¸ÙŠÙ Ø¢Ø«Ø§Ø± Ø§Ù„Ø¯Ù‡Ø§Ù†", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "ØªØ¹ØªÙŠÙ‚/ØªØ´Ø·ÙŠØ¨", "acts": ["Ø§Ø®ØªØ¨Ø§Ø± Ù„ÙˆÙ† Ø§Ù„ØªØ¹ØªÙŠÙ‚ (Ø¹ÙŠÙ†Ø©)", "ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¹ØªÙŠÙ‚", "ØªØ«Ø¨ÙŠØª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© (Ø¥Ù† ÙˆØ¬Ø¯Øª)", "ÙØ­Øµ Ø§Ù„ØªÙ†Ø§Ø³Ù‚", "ØªØµØ­ÙŠØ­ Ù…Ù†Ø§Ø·Ù‚ ØºÙŠØ± Ù…ØªØ¬Ø§Ù†Ø³Ø©", "ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ", "Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¤Ù‚ØªØ©", "ØªÙˆØ«ÙŠÙ‚ Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "ØªØ±ÙƒÙŠØ¨/ØªØ«Ø¨ÙŠØª", "acts": ["ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ©", "ØªØ±ÙƒÙŠØ¨ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹", "ØªØ«Ø¨ÙŠØª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", "Ø¹Ø²Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ«Ø¨ÙŠØª", "ÙØ­Øµ Ø«Ø¨Ø§Øª/Ø§Ù‡ØªØ²Ø§Ø²", "ØªØ¹Ø¯ÙŠÙ„ Ø´Ø¯/ØªÙˆØ§Ø²Ù†", "ØªÙ†Ø¸ÙŠÙ", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©", "ØªØ³Ù„ÙŠÙ…"]}]}, {"main": "Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙˆØ§Ù„Ø¥Ù†Ø§Ø±Ø©", "subs": [{"sub": "ØªÙ…Ø¯ÙŠØ¯Ø§Øª", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ù†Ø§Ø±Ø© ÙˆÙ…Ø³Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª", "ØªÙˆØ±ÙŠØ¯ ÙƒØ§Ø¨Ù„Ø§Øª/Ù‚Ù†ÙˆØ§Øª", "ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª/Ø§Ù„Ù…ÙˆØ§Ø³ÙŠØ±", "Ø³Ø­Ø¨ Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª", "Ø¹Ø²Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆØµÙ„", "ØªØ£Ø±ÙŠØ¶ (Ø¥Ù† ÙˆØ¬Ø¯)", "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©/Ø¹Ø²Ù„", "ØªØ±Ù‚ÙŠÙ… Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª", "ØªÙ†Ø¸ÙŠÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø§Øª", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ"]}, {"sub": "ØªØ±ÙƒÙŠØ¨ ÙˆØ­Ø¯Ø§Øª Ø¥Ù†Ø§Ø±Ø©", "acts": ["ØªÙˆØ±ÙŠØ¯ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¥Ù†Ø§Ø±Ø©", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯/Ø§Ù„Ø­ÙˆØ§Ù…Ù„", "ØªÙˆØµÙŠÙ„ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", "Ø¹Ø²Ù„ Ù…Ø§Ù†Ø¹ Ù…Ø§Ø¡ (IP) Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©", "Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§Ø¡Ø©", "Ø¶Ø¨Ø· Ø§ØªØ¬Ø§Ù‡/Ø²Ø§ÙˆÙŠØ©", "ØªØµØ­ÙŠØ­ Ø£Ø¹Ø·Ø§Ù„", "ØªÙ†Ø¸ÙŠÙ", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…/Ù…Ø¤Ù‚Øª", "acts": ["ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù„ÙˆØ­Ø©/Ø§Ù„Ù…Ø¤Ù‚Øª", "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù„ÙˆØ­Ø©", "ØªÙˆØµÙŠÙ„ Ø§Ù„ØªØºØ°ÙŠØ©", "Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…Ø¤Ù‚Øª", "Ø§Ø®ØªØ¨Ø§Ø± ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù", "Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø­Ù…Ø§Ù„", "ØªÙˆØ«ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "ØªØ³Ù„ÙŠÙ… ØªØ´ØºÙŠÙ„ÙŠ", "Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ø¹Ø´Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ", "subs": [{"sub": "ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹", "acts": ["ØªÙ†Ø¸ÙŠÙ ÙˆØ¥Ø²Ø§Ù„Ø© Ù…Ø®Ù„ÙØ§Øª", "ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª", "ØªØ³ÙˆÙŠØ© Ø§Ù„Ø£Ø±Ø¶", "Ø¥Ø¶Ø§ÙØ© ØªØ±Ø¨Ø©/Ø±Ù…Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©", "Ø¯Ø­Ù„ Ø®ÙÙŠÙ ÙˆØªØ³ÙˆÙŠØ©", "ØªØ³Ù…ÙŠØ¯ ØªØ£Ø³ÙŠØ³ÙŠ", "Ø±ÙŠ ØªØ£Ø³ÙŠØ³ÙŠ", "ÙØ­Øµ Ù…Ù†Ø³ÙˆØ¨", "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ø²Ø±Ø§Ø¹Ø©", "ØªØ³Ù„ÙŠÙ… Ù…Ø±Ø­Ù„Ø©"]}, {"sub": "Ø²Ø±Ø§Ø¹Ø©", "acts": ["ØªÙˆØ±ÙŠØ¯ Ø±ÙˆÙ„Ø§Øª/Ø´ØªÙˆÙ„ Ø§Ù„Ø¹Ø´Ø¨", "ÙØ±Ø´ ÙˆØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø±ÙˆÙ„Ø§Øª", "Ù‚Øµ ÙˆØªØ´ÙƒÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ù", "ØªØ«Ø¨ÙŠØª ÙˆÙ…Ù†Ø¹ ÙØ±Ø§ØºØ§Øª", "Ø±ÙŠ Ø£ÙˆÙ„ÙŠ ÙƒØ«ÙŠÙ", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù†Ø§Ø·Ù‚ Ø¶Ø¹ÙŠÙØ©", "Ø±ÙŠ Ø¯ÙˆØ±ÙŠ Ø£ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹", "Ù‚Øµ Ø£ÙˆÙ„ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª)", "ØªØ³Ù…ÙŠØ¯ Ù…ØªØ§Ø¨Ø¹Ø©", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ø¹Ù†Ø§ÙŠØ© ÙˆØªØ´ØºÙŠÙ„", "acts": ["Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø±ÙŠ ÙŠÙˆÙ…ÙŠ", "Ø¶Ø¨Ø· Ù…Ø¤Ù‚ØªØ§Øª Ø§Ù„Ø±ÙŠ", "ÙØ­Øµ ØªØµØ±ÙŠÙ/ØªØ¬Ù…Ø¹ Ù…ÙŠØ§Ù‡", "Ù…ÙƒØ§ÙØ­Ø© Ø¢ÙØ§Øª (Ø¥Ù† Ù„Ø²Ù…)", "ØªÙ‚Ù„ÙŠÙ…/Ù‚Øµ Ø¯ÙˆØ±ÙŠ", "ØªØ±Ù‚ÙŠØ¹ ÙØ±Ø§ØºØ§Øª", "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø·Ø­Ø§Øª", "ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„Ø©", "Ø§Ø³ØªÙ„Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø©", "Ø¥ØºÙ„Ø§Ù‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]}]}, {"main": "Ø´Ø¨ÙƒØ© Ø§Ù„Ø±ÙŠ + Ø§Ù„Ù…Ø¶Ø®Ø© + Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª", "subs": [{"sub": "Ø´Ø¨ÙƒØ© Ø±ÙŠ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠØ©", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø±ÙŠ", "ØªØµÙ…ÙŠÙ… Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©", "ØªÙˆØ±ÙŠØ¯ Ø£Ù†Ø§Ø¨ÙŠØ¨/Ù…Ø±Ø´Ø§Øª/ÙÙ„Ø§ØªØ±", "Ø­ÙØ±/ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨", "ØªØ±ÙƒÙŠØ¨ Ù…Ø±Ø´Ø§Øª/Ù†Ù‚Ø§Ø· ØªÙ†Ù‚ÙŠØ·", "ØªØ±ÙƒÙŠØ¨ Ù…Ø­Ø§Ø¨Ø³/ÙØ§Ù„Ø§Øª", "Ø§Ø®ØªØ¨Ø§Ø± Ø¶ØºØ·", "Ø¶Ø¨Ø· ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ§Ù‡", "Ø¥ØµÙ„Ø§Ø­ ØªØ³Ø±ÙŠØ¨Ø§Øª", "ØªØ³Ù„ÙŠÙ… ØªØ´ØºÙŠÙ„ÙŠ"]}, {"sub": "Ù…Ø¶Ø®Ø©", "acts": ["ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù…Ø¶Ø®Ø©/Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª", "ØªØ±ÙƒÙŠØ¨ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¶Ø®Ø©", "Ø±Ø¨Ø· Ø§Ù„Ø³Ø­Ø¨/Ø§Ù„Ø¯ÙØ¹", "ØªÙˆØµÙŠÙ„ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙˆØªØ£Ø±ÙŠØ¶", "ØªØ´ØºÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ", "Ø§Ø®ØªØ¨Ø§Ø± Ø¶ØºØ·/ØªØ¯ÙÙ‚", "Ø¶Ø¨Ø· Ø§Ù„Ø­Ù…Ø§ÙŠØ© (Ù‚Ø§Ø·Ø¹/Ø­Ø³Ø§Ø³ Ø¥Ù† ÙˆØ¬Ø¯)", "Ø§Ø®ØªØ¨Ø§Ø± ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ", "ØªÙˆØ«ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "ØªØ³Ù„ÙŠÙ…"]}, {"sub": "Ø®Ø²Ø§Ù†Ø§Øª", "acts": ["ÙØ­Øµ Ø®Ø²Ø§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©", "ØµÙŠØ§Ù†Ø©/ØªÙ†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ÙŠ", "ØªÙˆØ±ÙŠØ¯ Ø®Ø²Ø§Ù† Ø¬Ø¯ÙŠØ¯ (Ø¥Ù† Ù„Ø²Ù…)", "ØªØ±ÙƒÙŠØ¨ ÙˆØªØ«Ø¨ÙŠØª", "Ø±Ø¨Ø· Ø§Ù„Ø´Ø¨ÙƒØ© Ø¨Ø§Ù„Ø®Ø²Ø§Ù†", "Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø±ÙŠØ¨", "ØªØ¹Ù‚ÙŠÙ…/ØªÙ†Ø¸ÙŠÙ", "ØªØºØ·ÙŠØ© ÙˆØ­Ù…Ø§ÙŠØ©", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}]}, {"main": "Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª", "subs": [{"sub": "ØªÙˆØ±ÙŠØ¯", "acts": ["ØªØ¬Ù…ÙŠØ¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù", "ØªØ­Ø¯ÙŠØ¯ Ø£Ø­Ø¬Ø§Ù…/Ù…ÙˆØ§ØµÙØ§Øª", "ØªÙˆØ±ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹", "ÙØ±Ø² ÙˆÙØ­Øµ Ø¬ÙˆØ¯Ø©", "ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Ù…Ø¸Ù„Ù„", "Ø±ÙŠ Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", "Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØ¶Ø±Ø±", "ØªØ³Ù„ÙŠÙ… ØªÙˆØ±ÙŠØ¯", "ØªÙˆØ«ÙŠÙ‚ ØµÙˆØ±", "Ø¥ØºÙ„Ø§Ù‚ Ù…Ø±Ø­Ù„Ø©"]}, {"sub": "Ø²Ø±Ø§Ø¹Ø©", "acts": ["ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø­ÙˆØ§Ø¶/Ø§Ù„ØªØ±Ø¨Ø©", "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø·Ø·", "Ø²Ø±Ø§Ø¹Ø© ÙˆØªØ«Ø¨ÙŠØª", "Ø¥Ø¶Ø§ÙØ© Ø³Ù…Ø§Ø¯ ØªØ£Ø³ÙŠØ³ÙŠ", "Ø±ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©", "ØªØ«Ø¨ÙŠØª Ø¯Ø¹Ø§Ù…Ø§Øª (Ø¥Ù† Ù„Ø²Ù…)", "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹", "ÙØ­Øµ Ø§Ø³ØªÙ‚Ø§Ù…Ø©/ØªÙˆØ²ÙŠØ¹", "Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ÙŠ", "Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ"]}, {"sub": "Ø¹Ù†Ø§ÙŠØ© ÙˆØµÙŠØ§Ù†Ø©", "acts": ["Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø±ÙŠ", "ØªÙ‚Ù„ÙŠÙ…", "Ù…ÙƒØ§ÙØ­Ø© Ø¢ÙØ§Øª", "ØªÙ†Ø¸ÙŠÙ Ø£ÙˆØ±Ø§Ù‚", "Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ØªØ§Ù„Ù", "ØªØ³Ù…ÙŠØ¯ Ù…ØªØ§Ø¨Ø¹Ø©", "ÙØ­Øµ Ø¯ÙˆØ±ÙŠ", "ØªÙˆØ«ÙŠÙ‚", "Ø§Ø³ØªÙ„Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø©", "Ø¥ØºÙ„Ø§Ù‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]}]}, {"main": "Ø£Ø¹Ù…Ø§Ù„ Ø¹Ø§Ù…Ø©", "subs": [{"sub": "ØªÙ†Ø¸ÙŠÙ ÙˆØªØ±Ø­ÙŠÙ„", "acts": ["Ø¬Ù…Ø¹ Ù…Ø®Ù„ÙØ§Øª ÙŠÙˆÙ…ÙŠ", "ÙØ±Ø² Ù…Ø®Ù„ÙØ§Øª (Ø¥Ù† Ø£Ù…ÙƒÙ†)", "ØªØ­Ù…ÙŠÙ„", "Ù†Ù‚Ù„ ÙˆØªØ±Ø­ÙŠÙ„", "ØªÙØ±ÙŠØº ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯", "ØªÙ†Ø¸ÙŠÙ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„", "Ù…Ø³Ø­/ØºØ³ÙŠÙ„ Ø£Ø±Ø¶ÙŠØ§Øª", "ØªÙ†Ø¸ÙŠÙ Ø£Ø¯ÙˆØ§Øª", "Ø¥ØºÙ„Ø§Ù‚ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„", "Ø§Ø³ØªÙ„Ø§Ù…"]}, {"sub": "Ø³Ù„Ø§Ù…Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ù…ÙˆÙ‚Ø¹", "acts": ["ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø±Ø§Øª Ø­Ø±ÙƒØ©", "Ù„ÙˆØ­Ø§Øª ØªØ­Ø°ÙŠØ±ÙŠØ©", "ØªØ£Ù…ÙŠÙ† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©", "ØªÙ†Ø¸ÙŠÙ… ØªØ®Ø²ÙŠÙ† Ù…ÙˆØ§Ø¯", "Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø³Ø§Ø³Ø©", "Ø¶Ø¨Ø· Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬", "ÙØ­Øµ ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø³Ù„Ø§Ù…Ø©", "Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø®Ø§Ø·Ø±", "ØªÙˆØ«ÙŠÙ‚", "Ø¥ØºÙ„Ø§Ù‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]}]}];

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.
const ADMIN_TASKS = ["Ø§Ø¬ØªÙ…Ø§Ø¹","Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…","ØªÙ†Ø³ÙŠÙ‚ Ù…ÙˆØ§Ø¯","Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø®Ø·Ø·Ø§Øª","ØªÙˆØ¬ÙŠÙ‡Ø§Øª","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"];

let state = loadState();
let current = null;

const $ = (id) => document.getElementById(id);
const uid = () => Math.random().toString(16).slice(2,10) + "-" + Date.now().toString(16);

function loadState() {
  try {
    const raw = localStorage.getItem(KEY);
    if (!raw) return structuredClone(DEFAULTS);
    const p = JSON.parse(raw);
    return {
      settings: {...DEFAULTS.settings, ...(p.settings||{})},
      drafts: p.drafts || {},
      reports: Array.isArray(p.reports) ? p.reports : [],
      pendingDocs: Array.isArray(p.pendingDocs) ? p.pendingDocs : []
    };
  } catch(e) { return structuredClone(DEFAULTS); }
}
function saveState() {
  localStorage.setItem(KEY, JSON.stringify(state));
  $("appTitle").textContent = state.settings.title || DEFAULTS.settings.title;
}
async function loadTaxonomy() {
  const fromLocal = () => {
    try {
      const raw = localStorage.getItem(TAX_CACHE_KEY);
      if (!raw) return null;
      const data = JSON.parse(raw);
      return (Array.isArray(data) && data.length) ? data : null;
    } catch (e) { return null; }
  };

  // 1) Try network/file
  try {
    const r = await fetch("./taxonomy.json", { cache: "reload" });
    if (r.ok) {
      const data = await r.json();
      if (Array.isArray(data) && data.length) {
        localStorage.setItem(TAX_CACHE_KEY, JSON.stringify(data));
        return data;
      }
    }
  } catch (e) {
    // ignore
  }

  // 2) Fallback to cached taxonomy
  const cached = fromLocal();
  if (cached) return cached;

  // 3) Final fallback (embedded)
  return EMBED_TAXONOMY;
}

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©Ø› ØªÙ… Ø¥Ø²Ø§Ù„Ø© "more" ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
const views = ["dashboard","daily","plan","material","inspection","ncr","settings","history"];
function navTo(v) {
  // Ø¥Ø®ÙØ§Ø¡ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯
  views.forEach(x => $("v-"+x).classList.toggle("hidden", x!==v));
  // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ
  const navBtns = ["dashboard","daily","plan","material","inspection","ncr","settings"];
  navBtns.forEach(x => {
    const btn = $("n-"+x);
    if (btn) btn.classList.toggle("active", x===v);
  });
  localStorage.setItem("mazza_pm_v3_last_view", v);
  if (v==="history") renderHistory();
  if (v==="settings") fillSettings();
  if (v==="ncr") refreshNcrNo();
  window.scrollTo({top:0,behavior:"instant"});
}

function fillMain(prefix) {
  const m = $(prefix+"_main");
  m.innerHTML = "";
  TAXONOMY.forEach(t => {
    const o=document.createElement("option");
    o.value=t.main; o.textContent=t.main;
    m.appendChild(o);
  });
  m.addEventListener("change", () => fillSub(prefix));
  fillSub(prefix);
}
function fillSub(prefix) {
  const main = $(prefix+"_main").value;
  const t = TAXONOMY.find(x=>x.main===main);
  const s = $(prefix+"_sub"); s.innerHTML="";
  (t?.subs||[]).forEach(sub => {
    const o=document.createElement("option");
    o.value=sub.sub; o.textContent=sub.sub;
    s.appendChild(o);
  });
  s.addEventListener("change", () => fillAct(prefix));
  fillAct(prefix);
}
function fillAct(prefix) {
  const main = $(prefix+"_main").value;
  const sub = $(prefix+"_sub").value;
  const t = TAXONOMY.find(x=>x.main===main);
  const ss = t?.subs?.find(x=>x.sub===sub);
  const a = $(prefix+"_act"); a.innerHTML="";
  (ss?.acts||["â€”"]).forEach(act => {
    const o=document.createElement("option");
    o.value=act; o.textContent=act;
    a.appendChild(o);
  });
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ© ======
function fillAdminSelect(){
  const sel = $("daily_admin_select");
  if (!sel) return;
  sel.innerHTML = "";
  ADMIN_TASKS.forEach(task => {
    const o=document.createElement("option");
    o.value=task; o.textContent=task;
    sel.appendChild(o);
  });
}

function addAdminTask(){
  const sel = $("daily_admin_select");
  const val = sel && sel.value;
  if (!val) return;
  const d=getDraft("daily");
  d.admin = Array.isArray(d.admin) ? d.admin : [];
  d.admin.push(val);
  setDraft("daily", d);
  renderAdminList();
}

function removeAdminTask(idx){
  const d=getDraft("daily");
  if (!Array.isArray(d.admin)) return;
  d.admin.splice(idx,1);
  setDraft("daily", d);
  renderAdminList();
}

function renderAdminList(){
  const el = $("daily_admin_list");
  if (!el) return;
  const d=getDraft("daily");
  const list = Array.isArray(d.admin) ? d.admin : [];
  if (!list.length){ el.textContent=""; return; }
  el.innerHTML="";
  list.forEach((item, idx) => {
    const div=document.createElement("div");
    div.className="pill";
    div.innerHTML = `<div style="flex:1">${idx+1}) ${item}</div><button class="danger" onclick="removeAdminTask(${idx})">âœ–ï¸</button>`;
    el.appendChild(div);
  });
}
function clearPick(prefix){ fillAct(prefix); }

function getDraft(type) {
  const d = state.drafts[type];
  if (d) return d;
  const today = new Date().toISOString().slice(0,10);
  if (type==="daily") return {date:today,weather:"Ù…Ø´Ù…Ø³",workers:0,engineers:0,work:[],admin:[],notes:"",sender:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"};
  if (type==="plan") return {date:new Date(Date.now()+86400000).toISOString().slice(0,10),start:"",duration:0,need_pm:"no",work:[],notes:"",sender:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"};
  if (type==="material") return {date:today,status:"pending",main:"",sub:"",act:"",item:"",supplier:"",notes:"",sender:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"};
  if (type==="ncr") return {no:"",sev:"low",main:"",sub:"",act:"",desc:"",action:"",deadline:today,file:null,sender:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"};
  if (type==="inspection") return {dt:"",need_pm:"no",type:"Ù…Ø¯Ù†ÙŠ/Ø¥Ù†Ø´Ø§Ø¦ÙŠ",loc:"",notes:"",sender:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"};
  return {};
}
function setDraft(type, d){ state.drafts[type]=d; saveState(); }
function saveDraft(type){ setDraft(type, readForm(type)); toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©."); }

function addWork(type) {
  const d=getDraft(type);
  const main=$(type+"_main").value, sub=$(type+"_sub").value, act=$(type+"_act").value;
  d.work = d.work || [];
  d.work.push({main,sub,act,note:""});
  setDraft(type,d);
  renderWork(type);
}
function delWork(type,i){
  const d=getDraft(type);
  d.work.splice(i,1);
  setDraft(type,d);
  renderWork(type);
}
function setNote(type,i,val){
  const d=getDraft(type);
  d.work[i].note=val;
  setDraft(type,d);
}
function renderWork(type){
  const d=getDraft(type);
  const list = d.work||[];
  const el=$(type+"_list");
  if (!list.length){ el.textContent="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯."; return; }
  el.innerHTML="";
  list.forEach((w,i)=>{
    const div=document.createElement("div");
    div.className="pill";
    div.innerHTML = `
      <button class="x danger" onclick="delWork('${type}',${i})">Ø­Ø°Ù</button>
      <div style="flex:1;min-width:0">
        <div><b>${w.main}</b> / ${w.sub} / ${w.act}</div>
        <input style="margin-top:8px" value="${(w.note||"").replaceAll('"','&quot;')}"
               placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" oninput="setNote('${type}',${i},this.value)">
      </div>`;
    el.appendChild(div);
  });
}

function readForm(type){
  if (type==="daily"){
    const d=getDraft("daily");
    return {
      date:$("daily_date").value,
      weather:$("daily_weather").value,
      workers:Number($("daily_workers").value||0),
      engineers:Number($("daily_engineers").value||0),
      work:d.work||[],
      admin:d.admin||[],
      notes:$("daily_notes").value||"",
      sender:$("daily_sender").value||""
    };
  }
  if (type==="plan"){
    const d=getDraft("plan");
    return {
      date:$("plan_date").value,
      start:$("plan_start").value,
      duration:Number($("plan_duration").value||0),
      need_pm:$("plan_need_pm").value,
      work:d.work||[],
      notes:$("plan_notes").value||"",
      sender:$("plan_sender").value||""
    };
  }
  if (type==="material"){
    return {
      date:$("mat_date").value,
      status:$("mat_status").value,
      main:$("mat_main").value,
      sub:$("mat_sub").value,
      act:$("mat_act").value,
      item:$("mat_item").value||"",
      supplier:$("mat_supplier").value||"",
      notes:$("mat_notes").value||"",
      sender:$("mat_sender").value||""
    };
  }
  if (type==="ncr"){
    const d=getDraft("ncr");
    return {
      no:$("ncr_no").value,
      sev:$("ncr_sev").value,
      main:$("ncr_main").value,
      sub:$("ncr_sub").value,
      act:$("ncr_act").value,
      desc:$("ncr_desc").value||"",
      action:$("ncr_action").value||"",
      deadline:$("ncr_deadline").value,
      file:d.file||null,
      sender:$("ncr_sender").value||""
    };
  }
  if (type==="inspection"){
    return {
      dt:$("insp_dt").value,
      need_pm:$("insp_need_pm").value,
      type:$("insp_type").value,
      loc:$("insp_loc").value||"",
      notes:$("insp_notes").value||"",
      sender:$("insp_sender").value||""
    };
  }
  return getDraft(type);
}
function fillForm(type){
  const d=getDraft(type);
  if (type==="daily"){
    $("daily_date").value=d.date; $("daily_weather").value=d.weather;
    $("daily_workers").value=d.workers; $("daily_engineers").value=d.engineers;
    $("daily_notes").value=d.notes;
    // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø³Ù„
    renderWork("daily");
    renderAdminList();
    $("daily_sender").value = d.sender || "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹";
  }
  if (type==="plan"){
    $("plan_date").value=d.date; $("plan_need_pm").value=d.need_pm;
    $("plan_start").value=d.start || "";
    $("plan_duration").value = Number(d.duration||0);
    $("plan_notes").value=d.notes;
    $("plan_sender").value = d.sender || "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹";
    renderWork("plan");
  }
  if (type==="material"){
    $("mat_date").value=d.date; $("mat_status").value=d.status;
    $("mat_item").value=d.item; $("mat_supplier").value=d.supplier;
    $("mat_notes").value=d.notes;
    if (d.main){ $("mat_main").value=d.main; }
    fillSub("mat");
    if (d.sub){ $("mat_sub").value=d.sub; }
    fillAct("mat");
    if (d.act){ $("mat_act").value=d.act; }
    $("mat_sender").value = d.sender || "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹";
  }
  if (type==="ncr"){
    $("ncr_sev").value=d.sev; $("ncr_desc").value=d.desc;
    $("ncr_action").value=d.action; $("ncr_deadline").value=d.deadline;
    $("ncr_sender").value = d.sender || "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹";
  }
  if (type==="inspection"){
    $("insp_dt").value=d.dt; $("insp_need_pm").value=d.need_pm;
    $("insp_type").value=d.type; $("insp_loc").value=d.loc; $("insp_notes").value=d.notes;
    $("insp_sender").value = d.sender || "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹";
  }
}

function nextNcrNo(){
  const n = state.reports.filter(r=>r.type==="ncr").reduce((mx,r)=>{
    const m=(r.meta?.ncrNo||"").match(/NCR-(\d+)/); return m ? Math.max(mx,Number(m[1])) : mx;
  },0);
  return "NCR-" + String(n+1).padStart(3,"0");
}
function refreshNcrNo(){ $("ncr_no").value = nextNcrNo(); }

function generate(type){
  const d = readForm(type);
  setDraft(type,d);
  const s = state.settings;
  const enteredBy = s.name ? `Ø§Ù„Ù…ÙØ¯Ø®Ù„: ${s.name}` : "Ø§Ù„Ù…ÙØ¯Ø®Ù„: (ØºÙŠØ± Ù…Ø­Ø¯Ø¯)";
  const senderLine = d.sender ? `Ø§Ù„Ù…Ø±Ø³Ù„: ${d.sender}` : "";

  const lines=[];
  let title="";
  let meta={};

  if (type==="daily"){
    title="ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ";
    lines.push("=== ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ | Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø© ===");
    lines.push(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${d.date}`);
    lines.push(`Ø§Ù„Ø·Ù‚Ø³: ${d.weather}`);
    lines.push(`Ø§Ù„Ø¹Ù…Ø§Ù„: ${d.workers} | Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙˆÙ†: ${d.engineers}`);
    lines.push("------------------------------");
    lines.push("Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù†ÙØ°Ø©:");
    if (!(d.work||[]).length) lines.push("Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    else (d.work||[]).forEach((it,i)=>{
      const base=`${i+1}) ${it.main} / ${it.sub} / ${it.act}`;
      lines.push(it.note? base + ` â€” Ù…Ù„Ø§Ø­Ø¸Ø©: ${it.note}` : base);
    });
    // Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ©
    if ((d.admin||[]).length){
      lines.push("------------------------------");
      lines.push("Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©/Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ÙŠØ©:");
      (d.admin||[]).forEach((item,i)=>{
        lines.push(`${i+1}) ${item}`);
      });
    }
    if (d.notes){ lines.push("------------------------------"); lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${d.notes}`); }
    lines.push("------------------------------");
    lines.push(enteredBy);
    if (senderLine) lines.push(senderLine);
    meta={date:d.date,weather:d.weather,workers:d.workers,engineers:d.engineers};
  }

  if (type==="plan"){
    title="Ø®Ø·Ø© Ø§Ù„ØºØ¯";
    lines.push("=== Ø®Ø·Ø© Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ | Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø© ===");
    lines.push(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${d.date}`);
    lines.push(`ÙŠØªØ·Ù„Ø¨ ØªÙˆØ§Ø¬Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ: ${d.need_pm==="yes"?"Ù†Ø¹Ù…":"Ù„Ø§"}`);
    // ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ù…Ø¯Ø©
    lines.push(`ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡: ${d.start ? d.start : "â€”"}`);
    lines.push(`Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©: ${d.duration ? d.duration + " Ø³Ø§Ø¹Ø©" : "â€”"}`);
    lines.push("------------------------------");
    lines.push("Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø®Ø·Ø·Ø©:");
    if (!(d.work||[]).length) lines.push("Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    else (d.work||[]).forEach((it,i)=>{
      const base=`${i+1}) ${it.main} / ${it.sub} / ${it.act}`;
      lines.push(it.note? base + ` â€” Ù…Ù„Ø§Ø­Ø¸Ø©: ${it.note}` : base);
    });
    if (d.notes){ lines.push("------------------------------"); lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${d.notes}`); }
    lines.push("------------------------------");
    lines.push(enteredBy);
    if (senderLine) lines.push(senderLine);
    meta={date:d.date,needPm:d.need_pm,start:d.start||"",duration:d.duration||0};
  }

  if (type==="material"){
    title="Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙˆØ§Ø¯";
    const statusAr={pending:"Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",approved:"Ù…Ù‚Ø¨ÙˆÙ„",conditional:"Ù…Ù‚Ø¨ÙˆÙ„ Ø¨Ù…Ù„Ø§Ø­Ø¸Ø§Øª",rejected:"Ù…Ø±ÙÙˆØ¶"}[d.status] || "Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©";
    lines.push("=== Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙˆØ§Ø¯ | Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø© ===");
    lines.push(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${d.date}`);
    lines.push(`Ø§Ù„Ù…Ø±Ø¬Ø¹: ${d.main} / ${d.sub} / ${d.act}`);
    lines.push(`Ø§Ù„Ù…Ø§Ø¯Ø©/Ø§Ù„ÙˆØµÙ: ${d.item||"â€”"}`);
    lines.push(`Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ù…ØµØ¯Ø±: ${d.supplier||"â€”"}`);
    lines.push("------------------------------");
    lines.push(`Ø§Ù„Ù‚Ø±Ø§Ø±: ${statusAr}`);
    if (d.notes) lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø±: ${d.notes}`);
    lines.push("------------------------------");
    lines.push(enteredBy);
    if (senderLine) lines.push(senderLine);
    meta={date:d.date,status:d.status,link:`${d.main} / ${d.sub} / ${d.act}`};
  }

  if (type==="ncr"){
    title="NCR Ø¹Ø¯Ù… Ù…Ø·Ø§Ø¨Ù‚Ø©";
    const sevAr={low:"Ù…Ù†Ø®ÙØ¶",med:"Ù…ØªÙˆØ³Ø·",high:"Ø¹Ø§Ù„"}[d.sev] || "Ù…ØªÙˆØ³Ø·";
    const ncrNo=$("ncr_no").value;

    lines.push("=== Ù…Ø­Ø¶Ø± Ø¹Ø¯Ù… Ù…Ø·Ø§Ø¨Ù‚Ø© (NCR) | Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø© ===");
    lines.push(`Ø§Ù„Ø±Ù‚Ù…: ${ncrNo}`);
    lines.push(`Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${sevAr}`);
    lines.push(`Ø§Ù„Ø¨Ù†Ø¯: ${d.main} / ${d.sub} / ${d.act}`);
    lines.push("------------------------------");
    lines.push(`ÙˆØµÙ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©: ${d.desc||"â€”"}`);
    lines.push(`Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ: ${d.action||"â€”"}`);
    lines.push(`Ø§Ù„Ù…Ù‡Ù„Ø©: ${d.deadline}`);
    if (d.file && state.settings.keepFiles==="no") lines.push("Ù…Ø±ÙÙ‚Ø§Øª: ØªÙ… Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© (ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„)");
    if (d.file && state.settings.keepFiles==="yes") lines.push("Ù…Ø±ÙÙ‚Ø§Øª: ØµÙˆØ±Ø© Ù…Ø­ÙÙˆØ¸Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„");
    lines.push("------------------------------");
    lines.push(enteredBy);
    if (senderLine) lines.push(senderLine);

    meta={ncrNo, severity:d.sev, link:`${d.main} / ${d.sub} / ${d.act}`};
  }

  if (type==="inspection"){
    title="Ø·Ù„Ø¨ ÙØ­Øµ";
    lines.push("=== Ø·Ù„Ø¨ ÙØ­Øµ | Ù…Ø´Ø±ÙˆØ¹ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø© ===");
    lines.push(`Ø§Ù„Ù†ÙˆØ¹: ${d.type}`);
    lines.push(`Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„Ù…ÙƒØ§Ù†: ${d.loc||"â€”"}`);
    lines.push(`Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${d.dt? d.dt.replace("T"," ") : "â€”"}`);
    lines.push(`ÙŠØªØ·Ù„Ø¨ Ø­Ø¶ÙˆØ± Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ: ${d.need_pm==="yes"?"Ù†Ø¹Ù…":"Ù„Ø§"}`);
    lines.push("------------------------------");
    lines.push(`Ø§Ù„Ø³Ø¨Ø¨/Ø§Ù„ÙˆØµÙ: ${d.notes||"â€”"}`);
    lines.push("------------------------------");
    lines.push(enteredBy);
    if (senderLine) lines.push(senderLine);

    meta={dt:d.dt,needPm:d.need_pm,inspType:d.type,loc:d.loc};
  }

  const text=lines.join("\n");
  current={id:uid(),type, title, text, createdAt:new Date().toISOString(), meta, payload:{type,title,text,meta,draft:d}};
  openOut(title,text);
}

function openOut(title,text){
  $("outTitle").textContent=title;
  $("outText").textContent=text;
  $("outHint").textContent="ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ùˆ Ø·Ø¨Ø§Ø¹ØªÙ‡/Ø­ÙØ¸Ù‡ PDF Ø£Ùˆ Ø­ÙØ¸Ù‡ Ø¨Ø§Ù„Ø³Ø¬Ù„.";
  $("outModal").classList.add("open");
}
function closeOut(){ $("outModal").classList.remove("open"); }

async function shareText(){
  if (!current) return;
  if (navigator.share){
    try{ await navigator.share({title:current.title,text:current.text}); toast("ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©."); }
    catch(e){ toast("ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©."); }
  } else toast("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù‡Ù†Ø§. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø³Ø®.");
}
async function copyText(){
  if (!current) return;
  try{ await navigator.clipboard.writeText(current.text); toast("ØªÙ… Ø§Ù„Ù†Ø³Ø®."); }
  catch(e){
    const ta=document.createElement("textarea"); ta.value=current.text; document.body.appendChild(ta);
    ta.select(); document.execCommand("copy"); ta.remove(); toast("ØªÙ… Ø§Ù„Ù†Ø³Ø®.");
  }
}
function waText(){ if(!current) return; window.open("https://wa.me/?text="+encodeURIComponent(current.text),"_blank"); }
function downloadTXT(){
  if(!current) return;
  const blob=new Blob([current.text],{type:"text/plain;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=`mazza_${current.type}_${new Date().toISOString().slice(0,10)}.txt`;
  a.click(); URL.revokeObjectURL(a.href);
}
function printText(){ if(!current) return; window.print(); }

function typeLabel(t){ return {daily:"ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ",plan:"Ø®Ø·Ø© Ø§Ù„ØºØ¯",material:"Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙˆØ§Ø¯",ncr:"NCR",inspection:"Ø·Ù„Ø¨ ÙØ­Øµ"}[t] || t; }

function saveToHistory(){
  if (!current) return;
  state.reports.unshift(current);
  const max=Number(state.settings.maxReports ?? 200);
  if (max>0 && state.reports.length>max) state.reports=state.reports.slice(0,max);
  saveState(); renderLast(); toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ù„Ø³Ø¬Ù„.");
}
function renderLast(){
  const r=state.reports[0];
  $("lastReport").textContent = r ? `Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ±: ${typeLabel(r.type)} â€¢ ${r.createdAt.slice(0,10)}` : "Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ±: Ù„Ø§ ÙŠÙˆØ¬Ø¯";
}

function renderHistory(){
  const q=($("hist_q").value||"").trim().toLowerCase();
  const t=$("hist_type").value||"all";
  const items=state.reports.filter(r=>{
    if (t!=="all" && r.type!==t) return false;
    if (!q) return true;
    return (r.text||"").toLowerCase().includes(q);
  });
  const el=$("hist_list");
  if (!items.length){ el.textContent="Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©."; return; }
  el.innerHTML="";
  items.forEach(r=>{
    const div=document.createElement("div");
    div.className="card";
    const hasDoc = r.meta && r.meta.docUrl;
    const docBtn = hasDoc
      ? `<button onclick="openDoc('${r.id}')">ÙØªØ­ Doc</button>`
      : `<button onclick="docOne('${r.id}')">Doc</button>`;
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start">
        <div style="min-width:0">
          <b>${typeLabel(r.type)}</b>
          <div class="muted">${r.createdAt.slice(0,10)} â€¢ ${r.title}</div>
        </div>
        <button onclick="delReport('${r.id}')" class="danger">Ø­Ø°Ù</button>
      </div>
      <div class="btns">
        <button onclick="openSaved('${r.id}')">Ø¹Ø±Ø¶</button>
        <button onclick="copySaved('${r.id}')">Ù†Ø³Ø®</button>
        <button onclick="waSaved('${r.id}')">ÙˆØ§ØªØ³Ø§Ø¨</button>
      </div>
      <div class="btns">
        <button onclick="jsonOne('${r.id}')">JSON</button>
        ${docBtn}
      </div>`;
    el.appendChild(div);
  });
}
function findReport(id){ return state.reports.find(x=>x.id===id); }
function openSaved(id){ const r=findReport(id); if(!r) return; current=r; openOut(r.title,r.text); }
function copySaved(id){ const r=findReport(id); if(!r) return; current=r; copyText(); }
function waSaved(id){ const r=findReport(id); if(!r) return; window.open("https://wa.me/?text="+encodeURIComponent(r.text),"_blank"); }
function delReport(id){
  if (!confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ")) return;
  state.reports=state.reports.filter(x=>x.id!==id);
  saveState(); renderHistory(); renderLast();
}

// ÙØªØ­ Ù…Ø³ØªÙ†Ø¯ Google Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù† ÙˆØ¬Ø¯Ø› ÙˆØ¥Ù„Ø§ Ø¥Ù†Ø´Ø§Ø¡Ù‡
function openDoc(id){
  const r = findReport(id);
  if(!r) return;
  if(r.meta && r.meta.docUrl){
    window.open(r.meta.docUrl, "_blank");
  } else {
    docOne(id);
  }
}
function downloadJson(obj, filename){
  const blob=new Blob([JSON.stringify(obj,null,2)],{type:"application/json;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=filename;
  a.click(); URL.revokeObjectURL(a.href);
}
function jsonOne(id){
  const r=findReport(id); if(!r) return;
  downloadJson(r, `mazza_${r.type}_${r.id}.json`);
}
function exportJSONFiltered(){
  const q=($("hist_q").value||"").trim().toLowerCase();
  const t=$("hist_type").value||"all";
  const items=state.reports.filter(r=>{
    if (t!=="all" && r.type!==t) return false;
    if (!q) return true;
    return (r.text||"").toLowerCase().includes(q);
  });
  downloadJson({exportedAt:new Date().toISOString(),filter:{type:t,query:q},reports:items},
    `mazza_export_${t}_${new Date().toISOString().slice(0,10)}.json`);
}
function exportJSONAll(){
  downloadJson({exportedAt:new Date().toISOString(),filter:{type:"all"},reports:state.reports},
    `mazza_export_all_${new Date().toISOString().slice(0,10)}.json`);
}

async function postWebhook(payload){
  const url=(state.settings.webhookUrl||"").trim();
  if (!url){ toast("Ø£Ø¯Ø®Ù„ Webhook URL ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª."); return false; }
  try{
    const res=await fetch(url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    if (!res.ok){ toast("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Sheet."); return false; }
    toast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Sheet."); return true;
  } catch(e){ toast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€Webhook."); return false; }
}
function sheetPayload(r){
  const s=state.settings;
  return {project:s.title, enteredBy:s.name||"", reportType:r.type, reportTitle:r.title, createdAt:r.createdAt, meta:r.meta||{}, text:r.text, raw:r.payload||r};
}
async function sheetCurrent(){ if(!current) return; await postWebhook(sheetPayload(current)); }
async function sheetOne(id){ const r=findReport(id); if(!r) return; await postWebhook(sheetPayload(r)); }
async function exportToSheetFiltered(){
  const q=($("hist_q").value||"").trim().toLowerCase();
  const t=$("hist_type").value||"all";
  const items=state.reports.filter(r=>{
    if (t!=="all" && r.type!==t) return false;
    if (!q) return true;
    return (r.text||"").toLowerCase().includes(q);
  });
  if (!items.length){ toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„Ø¥Ø±Ø³Ø§Ù„."); return; }
  const s=state.settings;
  await postWebhook({batch:true,project:s.title,enteredBy:s.name||"",exportedAt:new Date().toISOString(),filter:{type:t,query:q},reports:items.map(sheetPayload)});
}
async function testWebhook(){
  const s=state.settings;
  await postWebhook({test:true,sentAt:new Date().toISOString(),message:"Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø²Ø©",project:s.title,enteredBy:s.name||""});
}

// ====== Google Docs Integration ======
function docPayload(r){
  return {
    type: r.type,
    id: r.id,
    createdAt: r.createdAt,
    payload: r.payload || {},
    generatedText: r.text,
    meta: r.meta || {}
  };
}
async function postDoc(payload){
  const url = (state.settings.docWebhookUrl || "").trim();
  if (!url){ toast("Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Google Doc ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª."); return null; }
  let fullUrl = url;
  const token = (state.settings.docWebhookToken || "").trim();
  if (token){
    fullUrl = url.includes("?") ? `${url}&token=${encodeURIComponent(token)}` : `${url}?token=${encodeURIComponent(token)}`;
  }
  try{
    const res = await fetch(fullUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    let json={};
    try{ json = await res.json(); } catch(e){ json = {}; }
    if(!res.ok || (json.ok!==undefined && !json.ok)){
      throw new Error(json.error || res.statusText || res.status);
    }
    return json;
  } catch(e){ return {error:String(e.message||e)}; }
}
async function docCurrent(){
  if(!current) return;
  const r=current;
  const payload = docPayload(r);
  const res = await postDoc(payload);
  if (!res || res.error){
    state.pendingDocs = state.pendingDocs || [];
    state.pendingDocs.push({id: r.id, payload});
    saveState();
    toast("ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.");
    $("outHint").textContent = "ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.";
    return;
  }
  // Success
  if(res.docUrl){
    // update current and history
    current.meta = current.meta || {};
    current.meta.docUrl = res.docUrl;
    const rep = findReport(r.id);
    if (rep){
      rep.meta = rep.meta || {};
      rep.meta.docUrl = res.docUrl;
    }
    saveState();
    renderHistory();
  }
  toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Google Ø¨Ù†Ø¬Ø§Ø­.");
  $("outHint").textContent = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Google Ø¨Ù†Ø¬Ø§Ø­.";
}
async function docOne(id){
  const r = findReport(id);
  if(!r) return;
  const payload = docPayload(r);
  const res = await postDoc(payload);
  if(!res || res.error){
    state.pendingDocs = state.pendingDocs || [];
    state.pendingDocs.push({id: r.id, payload});
    saveState();
    toast("ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.");
    return;
  }
  if(res.docUrl){
    r.meta = r.meta || {};
    r.meta.docUrl = res.docUrl;
    saveState();
    renderHistory();
  }
  toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Google Ø¨Ù†Ø¬Ø§Ø­.");
}
async function retryPendingDocs(){
  const list = Array.isArray(state.pendingDocs) ? state.pendingDocs.slice() : [];
  if(!list.length) return;
  const remaining=[];
  for(const item of list){
    const res = await postDoc(item.payload);
    if(!res || res.error){
      remaining.push(item);
    } else if(res.docUrl){
      const rep = findReport(item.id);
      if(rep){ rep.meta = rep.meta || {}; rep.meta.docUrl = res.docUrl; }
    }
  }
  state.pendingDocs = remaining;
  saveState();
  if(!remaining.length){ toast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¤Ø¬Ù„Ø©."); }
}
window.addEventListener("online", ()=>{ retryPendingDocs(); });

// Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
function showUpdatePrompt(reg){
  // Ø§Ø³ØªØ®Ø¯Ù… confirm Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«
  if (confirm("ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†ØŸ")){
    if (reg.waiting){ reg.waiting.postMessage({action:"skipWaiting"}); }
  } else {
    toast("Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.");
  }
}

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ÙŠØ·Ø± (Ø¨Ø¹Ø¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯)ØŒ Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
if ("serviceWorker" in navigator){
  navigator.serviceWorker.addEventListener("controllerchange", () => {
    window.location.reload();
  });
}

function fillSettings(){
  const s=state.settings;
  $("set_title").value=s.title||"";
  $("set_name").value=s.name||"";
  $("set_start").value=s.startDate||new Date().toISOString().slice(0,10);
  $("set_dur").value=Number(s.durationDays||45);
  $("set_max").value=Number(s.maxReports??200);
  $("set_keep_files").value=s.keepFiles||"no";
  $("set_webhook").value=s.webhookUrl||"";
  // Fill Google Docs settings
  $("set_doc_webhook").value=s.docWebhookUrl||"";
  $("set_doc_token").value=s.docWebhookToken||"";
}
function saveSettings(){
  state.settings.title=$("set_title").value||DEFAULTS.settings.title;
  state.settings.name=$("set_name").value||"";
  state.settings.startDate=$("set_start").value||new Date().toISOString().slice(0,10);
  state.settings.durationDays=Number($("set_dur").value||45);
  state.settings.maxReports=Number($("set_max").value||200);
  state.settings.keepFiles=$("set_keep_files").value||"no";
  state.settings.webhookUrl=$("set_webhook").value||"";
  state.settings.docWebhookUrl=$("set_doc_webhook").value||"";
  state.settings.docWebhookToken=$("set_doc_token").value||"";
  saveState(); toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª."); navTo("dashboard");
}
function resetAll(){
  if(!confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
  localStorage.removeItem(KEY); location.reload();
}

$("ncr_file").addEventListener("change", (e)=>{
  const file=e.target.files && e.target.files[0];
  if (!file) return;
  const keep = state.settings.keepFiles==="yes";
  const d=getDraft("ncr");
  if (!keep){
    d.file={name:file.name,type:file.type,size:file.size,kept:false};
    setDraft("ncr",d); toast("ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© (ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©)."); return;
  }
  const fr=new FileReader();
  fr.onload=()=>{
    d.file={name:file.name,type:file.type,size:file.size,kept:true,dataUrl:fr.result};
    setDraft("ncr",d); toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙÙ‚ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„.");
  };
  fr.readAsDataURL(file);
});

let toastTimer=null;
function toast(msg){
  let t=document.getElementById("toast");
  if(!t){
    t=document.createElement("div");
    t.id="toast";
    t.style.position="fixed";
    t.style.left="50%";
    t.style.transform="translateX(-50%)";
    t.style.bottom="calc(92px + env(safe-area-inset-bottom))";
    t.style.padding="10px 12px";
    t.style.border="1px solid rgba(255,255,255,.12)";
    t.style.background="rgba(255,255,255,.98)";
    t.style.color="#111827";
    t.style.borderRadius="999px";
    t.style.zIndex="99";
    t.style.fontSize="13px";
    document.body.appendChild(t);
  }
  t.textContent=msg; t.style.opacity="1";
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.style.opacity="0", 1700);
}

if ("serviceWorker" in navigator){
  // Ø³Ø¬Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ®Ø·Ø· Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js").then((reg) => {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ø§Ù…Ù„ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø§Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡
      if (reg.waiting) {
        showUpdatePrompt(reg);
      }
      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        newWorker.addEventListener("statechange", () => {
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
            showUpdatePrompt(reg);
          }
        });
      });
    }).catch(() => {});
  });
}

$("hist_q").addEventListener("input", renderHistory);
$("hist_type").addEventListener("change", renderHistory);

(async function init(){
  TAXONOMY = await loadTaxonomy();
  if (!TAXONOMY.length){ toast("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ taxonomy.json. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù„Ø§ ØªØ¸Ù‡Ø±: ØªØ£ÙƒØ¯ Ø£Ù† taxonomy.json Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø¬Ø§Ù†Ø¨ index.html Ø¹Ù„Ù‰ Netlify."); }
  $("appTitle").textContent=state.settings.title||DEFAULTS.settings.title;
  ["daily","plan","mat","ncr"].forEach(fillMain);

  // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  fillAdminSelect();

  fillForm("daily");
  fillForm("plan");
  fillForm("material");
  fillForm("ncr");
  fillForm("inspection");

  renderLast();
  const last=localStorage.getItem("mazza_pm_v3_last_view") || "dashboard";
  navTo(last);
  refreshNcrNo();
})();
</script>
</body>
</html>
